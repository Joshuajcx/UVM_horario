<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Horario UVM</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha512-Fo3rlrZj/k7ujTnHg4CGR2DkS1xJ9UZBtbP0lXcJY1zKkd9JljEuq49X4h4EaK5fJi1gYlIh5H2B+kgCMj4Lw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
    <header class="header-container">
        <div class="logo-container">
            <img src="logo.png" alt="Logo UVM" class="logo">
        </div>
        <nav class="nav-container">
            <ul class="nav-list">
                <li><a href="mi_horario.html"><i class="fas fa-sign-out-alt"></i> Mi horario</a></li>
                <li><a href="login.html"><i class="fas fa-sign-out-alt"></i> Cerrar sesión</a></li>
            </ul>
        </nav>
    </header>

    <main class="main-container">
        <section class="materias-section container">
            <h2>Escoge tus materias</h2>
            <form id="form-materias" class="form-container">
                <div class="form-group">
                    <label for="materia">Materia:</label>
                    <select id="materia" name="materia" required>
                        <!-- Las opciones se llenarán dinámicamente -->
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Añadir Materia</button>
            </form>
        </section>

        <section class="horario-section container">
            <h2>Horario</h2>
            <div class="table-responsive">
                <table class="horario-table">
                    <thead>
                        <tr>
                            <th>Hora</th>
                            <th>Lunes</th>
                            <th>Martes</th>
                            <th>Miércoles</th>
                            <th>Jueves</th>
                            <th>Viernes</th>
                            <th>Sábado</th>
                            <th>Salón</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>8:00 - 9:00</td>
                            <td id="lunes-8:00-9:00"></td>
                            <td id="martes-8:00-9:00"></td>
                            <td id="miercoles-8:00-9:00"></td>
                            <td id="jueves-8:00-9:00"></td>
                            <td id="viernes-8:00-9:00"></td>
                            <td id="sabado-8:00-9:00"></td>
                            <td id="salon-8:00-9:00"></td>
                        </tr>
                        <tr>
                            <td>9:00 - 10:00</td>
                            <td id="lunes-9:00-10:00"></td>
                            <td id="martes-9:00-10:00"></td>
                            <td id="miercoles-9:00-10:00"></td>
                            <td id="jueves-9:00-10:00"></td>
                            <td id="viernes-9:00-10:00"></td>
                            <td id="sabado-9:00-10:00"></td>
                            <td id="salon-9:00-10:00"></td>
                        </tr>
                        <tr>
                            <td>10:00 - 11:00</td>
                            <td id="lunes-10:00-11:00"></td>
                            <td id="martes-10:00-11:00"></td>
                            <td id="miercoles-10:00-11:00"></td>
                            <td id="jueves-10:00-11:00"></td>
                            <td id="viernes-10:00-11:00"></td>
                            <td id="sabado-10:00-11:00"></td>
                            <td id="salon-10:00-11:00"></td>
                        </tr>
                        <tr>
                            <td>11:00 - 12:00</td>
                            <td id="lunes-11:00-12:00"></td>
                            <td id="martes-11:00-12:00"></td>
                            <td id="miercoles-11:00-12:00"></td>
                            <td id="jueves-11:00-12:00"></td>
                            <td id="viernes-11:00-12:00"></td>
                            <td id="sabado-11:00-12:00"></td>
                            <td id="salon-11:00-12:00"></td>
                        </tr>
                        <tr>
                            <td>12:00 - 13:00</td>
                            <td id="lunes-12:00-13:00"></td>
                            <td id="martes-12:00-13:00"></td>
                            <td id="miercoles-12:00-13:00"></td>
                            <td id="jueves-12:00-13:00"></td>
                            <td id="viernes-12:00-13:00"></td>
                            <td id="sabado-12:00-13:00"></td>
                            <td id="salon-12:00-13:00"></td>
                        </tr>
                        <tr>
                            <td>13:00 - 14:00</td>
                            <td id="lunes-13:00-14:00"></td>
                            <td id="martes-13:00-14:00"></td>
                            <td id="miercoles-13:00-14:00"></td>
                            <td id="jueves-13:00-14:00"></td>
                            <td id="viernes-13:00-14:00"></td>
                            <td id="sabado-13:00-14:00"></td>
                            <td id="salon-13:00-14:00"></td>
                        </tr>
                        <tr>
                            <td>14:00 - 15:00</td>
                            <td id="lunes-14:00-15:00"></td>
                            <td id="martes-14:00-15:00"></td>
                            <td id="miercoles-14:00-15:00"></td>
                            <td id="jueves-14:00-15:00"></td>
                            <td id="viernes-14:00-15:00"></td>
                            <td id="sabado-14:00-15:00"></td>
                            <td id="salon-14:00-15:00"></td>
                        </tr>
                        <tr>
                            <td>15:00 - 16:00</td>
                            <td id="lunes-15:00-16:00"></td>
                            <td id="martes-15:00-16:00"></td>
                            <td id="miercoles-15:00-16:00"></td>
                            <td id="jueves-15:00-16:00"></td>
                            <td id="viernes-15:00-16:00"></td>
                            <td id="sabado-15:00-16:00"></td>
                            <td id="salon-15:00-16:00"></td>
                        </tr>
                        <tr>
                            <td>16:00 - 17:00</td>
                            <td id="lunes-16:00-17:00"></td>
                            <td id="martes-16:00-17:00"></td>
                            <td id="miercoles-16:00-17:00"></td>
                            <td id="jueves-16:00-17:00"></td>
                            <td id="viernes-16:00-17:00"></td>
                            <td id="sabado-16:00-17:00"></td>
                            <td id="salon-16:00-17:00"></td>
                        </tr>
                        <tr>
                            <td>17:00 - 18:00</td>
                            <td id="lunes-17:00-18:00"></td>
                            <td id="martes-17:00-18:00"></td>
                            <td id="miercoles-17:00-18:00"></td>
                            <td id="jueves-17:00-18:00"></td>
                            <td id="viernes-17:00-18:00"></td>
                            <td id="sabado-17:00-18:00"></td>
                            <td id="salon-17:00-18:00"></td>
                        </tr>
                        <tr>
                            <td>18:00 - 19:00</td>
                            <td id="lunes-18:00-19:00"></td>
                            <td id="martes-18:00-19:00"></td>
                            <td id="miercoles-18:00-19:00"></td>
                            <td id="jueves-18:00-19:00"></td>
                            <td id="viernes-18:00-19:00"></td>
                            <td id="sabado-18:00-19:00"></td>
                            <td id="salon-18:00-19:00"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="button-container">
                <button id="aceptar-horario" class="btn btn-success">Aceptar Horario</button>
            </div>
        </section>
    </main>

    <footer class="footer-container">
        <div class="footer-content">
            <p>&copy; 2024 - Universidad del Valle de México (UVM). Todos los derechos reservados.</p>
            <p>
                <a href="aviso_privacidad.html">Aviso de Privacidad</a> | 
                <a href="terminos_uso.html">Términos de Uso del Software</a>
            </p>
        </div>
    </footer>

    <script>
        // Fetch de materias desde el servidor y llenar el dropdown
        fetch('/api/materias')
            .then(response => response.json())
            .then(data => {
                const materiaSelect = document.getElementById('materia');
                data.forEach(materia => {
                    const option = document.createElement('option');
                    option.value = materia.id;
                    option.textContent = `${materia.nombre} (${materia.dia} ${materia.hora}) - Salón: ${materia.salon}`;
                    materiaSelect.appendChild(option);
                });
            })
            .catch(error => console.error('Error al cargar materias:', error));

        // Event listener para añadir materias al horario
        document.getElementById('form-materias').addEventListener('submit', function(event) {
            event.preventDefault();
            const materiaSelect = document.getElementById('materia');
            const materiaId = materiaSelect.value;
            if (materiaId) {
                fetch(`/api/materias/${materiaId}`)
                    .then(response => response.json())
                    .then(materia => {
                        const cellId = `${materia.dia.toLowerCase()}-${materia.hora}`;
                        document.getElementById(cellId).textContent = materia.nombre;
                        document.getElementById('salon-' + materia.hora).textContent = materia.salon;
                    })
                    .catch(error => console.error('Error al añadir materia:', error));
            } else {
                alert('Por favor, selecciona una materia.');
            }
            document.getElementById('form-materias').reset();
        });

        document.getElementById('aceptar-horario').addEventListener('click', function() {
    const horario = {};

    // Recolectar los datos del horario
    const horas = ['8:00-9:00', '9:00-10:00', '10:00-11:00', '11:00-12:00', '12:00-13:00', '13:00-14:00', '14:00-15:00', '15:00-16:00', '16:00-17:00', '17:00-18:00', '18:00-19:00'];
    horas.forEach(hora => {
        horario[hora] = {
            lunes: document.getElementById(`lunes-${hora}`).textContent,
            martes: document.getElementById(`martes-${hora}`).textContent,
            miercoles: document.getElementById(`miercoles-${hora}`).textContent,
            jueves: document.getElementById(`jueves-${hora}`).textContent,
            viernes: document.getElementById(`viernes-${hora}`).textContent,
            sabado: document.getElementById(`sabado-${hora}`).textContent,
            salon: document.getElementById(`salon-${hora}`).textContent
        };
    });

    // Enviar el horario a la base de datos
    fetch('/api/horarios', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            // Ejemplo de cómo agregar un horario específico
            // Debes agregar lógica para cada materia y su hora
            materia_id: 1, // ID de la materia seleccionada
            dia: 'Lunes',  // Día de la materia, este ejemplo lo fija a Lunes
            hora: '10:00', // Hora de la materia, se puede modificar según la selección
            salon: 'A101', // Salón asignado
            profesor: 'Dr. Pérez', // Profesor asignado
            id_usuario: 123  // ID del usuario autenticado
        })
    })
    .then(response => response.json())
    .then(data => {
        console.log('Horario guardado exitosamente:', data);
    })
    .catch(error => console.error('Error al guardar el horario:', error));
});
    </script>
</body>
</html>